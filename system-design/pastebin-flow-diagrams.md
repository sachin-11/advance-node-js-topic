# Pastebin System Design - Complete Flow Diagrams

## ğŸ”„ Complete System Flow

### 1. Paste Creation Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Client    â”‚
â”‚  (Browser)  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ POST /api/paste
       â”‚ { content: "...", language: "python" }
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      Load Balancer                  â”‚
â”‚  (Nginx/HAProxy/AWS ELB)            â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                  â”‚
       â”‚ Round-robin      â”‚
       â–¼                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Web Server â”‚    â”‚  Web Server â”‚
â”‚  Instance 1 â”‚    â”‚  Instance 2 â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚                  â”‚
       â”‚                  â”‚
       â–¼                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Application Server Layer         â”‚
â”‚                                     â”‚
â”‚  1. Validate input                  â”‚
â”‚     â”œâ”€ Check content (not empty)   â”‚
â”‚     â”œâ”€ Check file size limits      â”‚
â”‚     â””â”€ Rate limiting check          â”‚
â”‚  2. Generate paste ID               â”‚
â”‚     â”œâ”€ Base62 encoding (like URL)  â”‚
â”‚     â””â”€ Check uniqueness             â”‚
â”‚  3. Process content                 â”‚
â”‚     â”œâ”€ Detect language             â”‚
â”‚     â”œâ”€ Sanitize (XSS prevention)    â”‚
â”‚     â””â”€ If large: Prepare for S3     â”‚
â”‚  4. Store in database               â”‚
â”‚     â”œâ”€ Metadata in PostgreSQL      â”‚
â”‚     â””â”€ Content location (DB/S3)    â”‚
â”‚  5. Upload to S3 (if needed)        â”‚
â”‚  6. Cache hot paste                 â”‚
â”‚  7. Return paste URL                â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                  â”‚
       â”‚ Write            â”‚ Write
       â–¼                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Redis     â”‚    â”‚ PostgreSQL  â”‚
â”‚   Cache     â”‚    â”‚  Database   â”‚
â”‚             â”‚    â”‚             â”‚
â”‚  Key: paste:â”‚    â”‚  Table:     â”‚
â”‚    abc123   â”‚    â”‚  pastes     â”‚
â”‚  Value:     â”‚    â”‚             â”‚
â”‚  {content,  â”‚    â”‚  paste_id,  â”‚
â”‚   language} â”‚    â”‚  content,   â”‚
â”‚  TTL: 1hr  â”‚    â”‚  metadata   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ If large content
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚Object Storageâ”‚
â”‚   (S3)      â”‚
â”‚             â”‚
â”‚  Files &    â”‚
â”‚  Large      â”‚
â”‚  Pastes     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. Paste Retrieval Flow (Read Path)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Client    â”‚
â”‚  (Browser)  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ GET /paste/abc123
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      Load Balancer                  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                  â”‚
       â–¼                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Web Server â”‚    â”‚  Web Server â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚                  â”‚
       â–¼                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Application Server                â”‚
â”‚                                     â”‚
â”‚  1. Validate paste ID format        â”‚
â”‚  2. Check access control            â”‚
â”‚     â”œâ”€ If private: Check auth      â”‚
â”‚     â”œâ”€ If password: Verify password â”‚
â”‚     â””â”€ If expired: Return 404      â”‚
â”‚  3. Check Redis Cache (L1)          â”‚
â”‚     â”œâ”€ Cache HIT:                  â”‚
â”‚     â”‚   â”œâ”€ Return cached paste     â”‚
â”‚     â”‚   â””â”€ Update view count (async)â”‚
â”‚     â”‚                               â”‚
â”‚     â””â”€ Cache MISS:                  â”‚
â”‚         â”œâ”€ Check PostgreSQL (L2)   â”‚
â”‚         â”‚   â”œâ”€ Get metadata        â”‚
â”‚         â”‚   â”œâ”€ Get content locationâ”‚
â”‚         â”‚   â””â”€ If S3: Fetch contentâ”‚
â”‚         â”œâ”€ Apply syntax highlightingâ”‚
â”‚         â”œâ”€ Cache result            â”‚
â”‚         â””â”€ Update analytics (async) â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                  â”‚
       â”‚ Read             â”‚ Read
       â–¼                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Redis     â”‚    â”‚ PostgreSQL  â”‚
â”‚   Cache     â”‚    â”‚  Database   â”‚
â”‚             â”‚    â”‚             â”‚
â”‚  Fast Path  â”‚    â”‚  Fallback   â”‚
â”‚  (< 5ms)    â”‚    â”‚  (< 50ms)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ If content in S3
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚Object Storageâ”‚
â”‚   (S3)      â”‚
â”‚             â”‚
â”‚  Large      â”‚
â”‚  Content    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3. Syntax Highlighting Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Paste Content                   â”‚
â”‚  "print('Hello World')"                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Language Detection                   â”‚
â”‚                                         â”‚
â”‚  1. User specified language?           â”‚
â”‚     â”œâ”€ Yes: Use specified              â”‚
â”‚     â””â”€ No: Auto-detect                 â”‚
â”‚                                         â”‚
â”‚  2. Auto-detection methods:            â”‚
â”‚     â”œâ”€ File extension                  â”‚
â”‚     â”œâ”€ Shebang (#!)                    â”‚
â”‚     â”œâ”€ Keyword analysis                â”‚
â”‚     â””â”€ ML-based detection              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Highlighting Engine                  â”‚
â”‚                                         â”‚
â”‚  Option 1: Server-side (Pygments)      â”‚
â”‚    â”œâ”€ Pre-render HTML                  â”‚
â”‚    â”œâ”€ Cache highlighted HTML           â”‚
â”‚    â””â”€ Serve pre-rendered               â”‚
â”‚                                         â”‚
â”‚  Option 2: Client-side (Highlight.js)  â”‚
â”‚    â”œâ”€ Send raw content                 â”‚
â”‚    â”œâ”€ Highlight in browser             â”‚
â”‚    â””â”€ Faster initial load              â”‚
â”‚                                         â”‚
â”‚  Option 3: Hybrid                       â”‚
â”‚    â”œâ”€ Pre-render on server             â”‚
â”‚    â”œâ”€ Enhance on client                â”‚
â”‚    â””â”€ Best of both                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Generate HTML                        â”‚
â”‚                                         â”‚
â”‚  <pre><code class="language-python">   â”‚
â”‚    <span class="kw">print</span>(...)  â”‚
â”‚  </code></pre>                         â”‚
â”‚                                         â”‚
â”‚  + Apply theme/CSS                      â”‚
â”‚  + Add line numbers (optional)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Cache Highlighted HTML               â”‚
â”‚                                         â”‚
â”‚  Redis: paste:abc123:html               â”‚
â”‚  CDN: Static HTML file                  â”‚
â”‚  TTL: 24 hours                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4. File Upload Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Client    â”‚
â”‚  (Browser)  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ POST /api/paste/:id/file
       â”‚ Multipart form data
       â”‚ File: image.png (2MB)
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Application Server               â”‚
â”‚                                     â”‚
â”‚  1. Validate File                   â”‚
â”‚     â”œâ”€ Check file size (< 10MB)    â”‚
â”‚     â”œâ”€ Check file type (whitelist) â”‚
â”‚     â”œâ”€ Virus scan (ClamAV)         â”‚
â”‚     â””â”€ Rate limiting                â”‚
â”‚  2. Generate Unique Filename        â”‚
â”‚     â”œâ”€ UUID-based                  â”‚
â”‚     â””â”€ Preserve extension           â”‚
â”‚  3. Upload Strategy                 â”‚
â”‚     â”œâ”€ Small file (< 5MB):         â”‚
â”‚     â”‚   â””â”€ Direct upload           â”‚
â”‚     â”œâ”€ Medium (5-100MB):           â”‚
â”‚     â”‚   â””â”€ Multipart upload        â”‚
â”‚     â””â”€ Large (> 100MB):             â”‚
â”‚         â””â”€ Chunked upload           â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                  â”‚
       â”‚ Upload           â”‚ Store Metadata
       â–¼                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚Object Storageâ”‚    â”‚ PostgreSQL  â”‚
â”‚   (S3)      â”‚    â”‚  Database   â”‚
â”‚             â”‚    â”‚             â”‚
â”‚  Files/     â”‚    â”‚  files      â”‚
â”‚  Images     â”‚    â”‚  table      â”‚
â”‚  Documents  â”‚    â”‚             â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ CDN Integration
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     CDN     â”‚
â”‚ (CloudFront)â”‚
â”‚             â”‚
â”‚  Cached     â”‚
â”‚  Files      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5. User Authentication Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Client    â”‚
â”‚  (Browser)  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ POST /api/auth/login
       â”‚ { username: "user", password: "***" }
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Application Server               â”‚
â”‚                                     â”‚
â”‚  1. Validate Credentials            â”‚
â”‚     â”œâ”€ Check username/email         â”‚
â”‚     â”œâ”€ Verify password (bcrypt)     â”‚
â”‚     â””â”€ Check account status         â”‚
â”‚  2. Generate Session Token          â”‚
â”‚     â”œâ”€ JWT token creation           â”‚
â”‚     â”œâ”€ Include user ID, permissions â”‚
â”‚     â””â”€ Set expiration (7 days)      â”‚
â”‚  3. Store Session                   â”‚
â”‚     â”œâ”€ Store in Redis               â”‚
â”‚     â””â”€ Set TTL                      â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                  â”‚
       â”‚ Store Session    â”‚ Return Token
       â–¼                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Redis     â”‚    â”‚   Client    â”‚
â”‚   Cache     â”‚    â”‚             â”‚
â”‚             â”‚    â”‚  JWT Token  â”‚
â”‚  Key: sess: â”‚    â”‚  in Cookie  â”‚
â”‚    user123  â”‚    â”‚  or Header  â”‚
â”‚  Value:     â”‚    â”‚             â”‚
â”‚  {user_id,  â”‚    â”‚             â”‚
â”‚   expires}  â”‚    â”‚             â”‚
â”‚  TTL: 7days â”‚    â”‚             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6. Expiration Cleanup Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Cron Job (Every Hour)                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Cleanup Service                      â”‚
â”‚                                         â”‚
â”‚  1. Find Expired Pastes                â”‚
â”‚     â”œâ”€ Time-based:                     â”‚
â”‚     â”‚   WHERE expires_at < NOW()       â”‚
â”‚     â”œâ”€ View-based:                     â”‚
â”‚     â”‚   WHERE views >= max_views      â”‚
â”‚     â””â”€ Batch query (1000 at a time)   â”‚
â”‚                                         â”‚
â”‚  2. Delete Files from S3               â”‚
â”‚     â”œâ”€ Get file URLs                   â”‚
â”‚     â”œâ”€ Delete from object storage     â”‚
â”‚     â””â”€ Log deletions                  â”‚
â”‚                                         â”‚
â”‚  3. Delete from Database               â”‚
â”‚     â”œâ”€ Delete paste records           â”‚
â”‚     â”œâ”€ Delete analytics records       â”‚
â”‚     â””â”€ Delete file references         â”‚
â”‚                                         â”‚
â”‚  4. Clear Cache                        â”‚
â”‚     â”œâ”€ Delete from Redis              â”‚
â”‚     â””â”€ Invalidate CDN cache           â”‚
â”‚                                         â”‚
â”‚  5. Archive (Optional)                 â”‚
â”‚     â”œâ”€ Move to cold storage           â”‚
â”‚     â””â”€ Keep for compliance            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Database & Storage                   â”‚
â”‚                                         â”‚
â”‚  Deleted: 1,234 expired pastes          â”‚
â”‚  Files deleted: 456 files               â”‚
â”‚  Cache cleared: 1,234 keys              â”‚
â”‚  Archived: 100 pastes                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7. Analytics Tracking Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Paste View Request                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Application Server                   â”‚
â”‚                                         â”‚
â”‚  1. Serve paste (synchronous)           â”‚
â”‚  2. Queue analytics event (async)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â”‚ Async Queue
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Message Queue                        â”‚
â”‚    (RabbitMQ/Kafka/Redis Queue)         â”‚
â”‚                                         â”‚
â”‚  Event: {                               â”‚
â”‚    paste_id: "abc123",                  â”‚
â”‚    timestamp: "2024-12-07T12:00:00Z",  â”‚
â”‚    ip: "192.168.1.1",                   â”‚
â”‚    user_agent: "Chrome/...",            â”‚
â”‚    referrer: "google.com",              â”‚
â”‚    country: "US"                        â”‚
â”‚  }                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â”‚ Consumer Workers
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Analytics Processors                 â”‚
â”‚                                         â”‚
â”‚  1. Validate event                      â”‚
â”‚  2. Enrich with geo data                â”‚
â”‚     â”œâ”€ IP to country lookup            â”‚
â”‚     â””â”€ IP to city lookup               â”‚
â”‚  3. Update aggregate stats              â”‚
â”‚     â”œâ”€ Increment view count            â”‚
â”‚     â””â”€ Update unique views             â”‚
â”‚  4. Store in analytics DB              â”‚
â”‚     â”œâ”€ Insert into view_logs           â”‚
â”‚     â””â”€ Update analytics table          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Analytics Database                   â”‚
â”‚    (PostgreSQL)                         â”‚
â”‚                                         â”‚
â”‚  - view_logs table                      â”‚
â”‚  - analytics table (aggregates)        â”‚
â”‚  - Partitioned by date                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 8. Multi-Level Caching Strategy

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Request Flow                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Level 1: Application Memory Cache     â”‚
â”‚   (Local Cache - In-Memory)             â”‚
â”‚   - Size: 100MB per instance            â”‚
â”‚   - TTL: 5 minutes                      â”‚
â”‚   - Hit Rate: ~40%                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚ Cache Miss
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Level 2: Redis Cluster                â”‚
â”‚   (Distributed Cache)                   â”‚
â”‚   - Size: 50GB total                    â”‚
â”‚   - TTL: 1 hour                          â”‚
â”‚   - Hit Rate: ~80%                      â”‚
â”‚   - Replication: 3 replicas              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚ Cache Miss
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Level 3: CDN Cache                    â”‚
â”‚   (Static Content)                      â”‚
â”‚   - Highlighted HTML                    â”‚
â”‚   - Static files                        â”‚
â”‚   - TTL: 24 hours                       â”‚
â”‚   - Hit Rate: ~90%                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚ Cache Miss
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Level 4: Database (PostgreSQL)       â”‚
â”‚   - Master-Slave setup                  â”‚
â”‚   - Read from Slaves                    â”‚
â”‚   - Write to Master                     â”‚
â”‚   - Hit Rate: 100% (always available)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 9. Database Sharding Strategy

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Application Layer              â”‚
â”‚                                        â”‚
â”‚  Paste ID: "abc123"                    â”‚
â”‚  Shard Key: First char 'a'             â”‚
â”‚  Shard: 'a' â†’ Shard 1                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â”‚ Consistent Hashing
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Shard Router                    â”‚
â”‚  (Consistent Hash Ring)                 â”‚
â””â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”˜
   â”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”‚
   â–¼  â–¼  â–¼  â–¼  â–¼  â–¼  â–¼  â–¼  â–¼  â–¼  â–¼  â–¼
â”Œâ”€â”€â”â”Œâ”€â”€â”â”Œâ”€â”€â”â”Œâ”€â”€â”â”Œâ”€â”€â”â”Œâ”€â”€â”â”Œâ”€â”€â”â”Œâ”€â”€â”â”Œâ”€â”€â”â”Œâ”€â”€â”
â”‚S0â”‚â”‚S1â”‚â”‚S2â”‚â”‚S3â”‚â”‚S4â”‚â”‚S5â”‚â”‚S6â”‚â”‚S7â”‚â”‚S8â”‚â”‚S9â”‚
â”‚0-9â”‚â”‚a-fâ”‚â”‚g-mâ”‚â”‚n-tâ”‚â”‚u-zâ”‚â”‚A-Fâ”‚â”‚G-Mâ”‚â”‚N-Tâ”‚â”‚U-Zâ”‚
â””â”€â”€â”˜â””â”€â”€â”˜â””â”€â”€â”˜â””â”€â”€â”˜â””â”€â”€â”˜â””â”€â”€â”˜â””â”€â”€â”˜â””â”€â”€â”˜â””â”€â”€â”˜â””â”€â”€â”˜
   â”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”‚
   â””â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”˜
       Each Shard = Separate Database
       Replication: Master-Slave per Shard
```

### 10. CDN Distribution Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Client    â”‚
â”‚  (Browser)  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ GET /paste/abc123
       â”‚ (First Request)
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      CDN Edge Server                â”‚
â”‚      (Nearest Location)             â”‚
â”‚                                     â”‚
â”‚  1. Check CDN Cache                 â”‚
â”‚     â”œâ”€ Cache MISS                   â”‚
â”‚     â””â”€ Forward to Origin            â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ Origin Request
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      Origin Server                  â”‚
â”‚      (Application Server)           â”‚
â”‚                                     â”‚
â”‚  1. Generate highlighted HTML       â”‚
â”‚  2. Set cache headers               â”‚
â”‚     Cache-Control: public, max-age=86400â”‚
â”‚  3. Return content                  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ Cache & Return
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      CDN Edge Server                â”‚
â”‚                                     â”‚
â”‚  1. Cache content                   â”‚
â”‚  2. Return to client                â”‚
â”‚                                     â”‚
â”‚  Subsequent requests:                â”‚
â”‚  â””â”€ Serve from cache (< 10ms)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 11. Password-Protected Paste Access Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Client    â”‚
â”‚  (Browser)  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ GET /paste/abc123
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Application Server               â”‚
â”‚                                     â”‚
â”‚  1. Check if password protected     â”‚
â”‚     â”œâ”€ If no: Return paste         â”‚
â”‚     â””â”€ If yes: Continue             â”‚
â”‚  2. Check if password provided      â”‚
â”‚     â”œâ”€ If no: Return password form â”‚
â”‚     â””â”€ If yes: Verify password      â”‚
â”‚  3. Verify Password                 â”‚
â”‚     â”œâ”€ Get password_hash from DB   â”‚
â”‚     â”œâ”€ Compare with bcrypt          â”‚
â”‚     â””â”€ If match: Continue           â”‚
â”‚  4. Decrypt Content (if encrypted) â”‚
â”‚  5. Return paste                    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ Verify
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PostgreSQL  â”‚
â”‚  Database   â”‚
â”‚             â”‚
â”‚  password_ â”‚
â”‚  hash       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 12. Burn After Reading Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Client    â”‚
â”‚  (Browser)  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ GET /paste/abc123
       â”‚ (First View)
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Application Server               â”‚
â”‚                                     â”‚
â”‚  1. Check burn_after_reading flag  â”‚
â”‚  2. Check if already viewed         â”‚
â”‚     â”œâ”€ If yes: Return 404          â”‚
â”‚     â””â”€ If no: Continue             â”‚
â”‚  3. Retrieve paste content          â”‚
â”‚  4. Mark as viewed                  â”‚
â”‚     â”œâ”€ Set viewed flag in DB       â”‚
â”‚     â””â”€ Delete from cache           â”‚
â”‚  5. Delete paste                    â”‚
â”‚     â”œâ”€ Delete from database        â”‚
â”‚     â”œâ”€ Delete files from S3        â”‚
â”‚     â””â”€ Clear cache                 â”‚
â”‚  6. Return content (one-time)      â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ Delete
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PostgreSQL  â”‚    â”‚Object Storageâ”‚
â”‚  Database   â”‚    â”‚   (S3)      â”‚
â”‚             â”‚    â”‚             â”‚
â”‚  Delete     â”‚    â”‚  Delete     â”‚
â”‚  Record     â”‚    â”‚  Files      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“Š Performance Metrics Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Application Servers                  â”‚
â”‚    (Instrumented with metrics)          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â”‚ Metrics Export
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Metrics Collector                    â”‚
â”‚    (Prometheus/StatsD)                   â”‚
â”‚                                         â”‚
â”‚  - Request count                        â”‚
â”‚  - Response time (p50, p95, p99)       â”‚
â”‚  - Error rate                           â”‚
â”‚  - Cache hit rate                       â”‚
â”‚  - Database query time                  â”‚
â”‚  - File upload time                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Monitoring Dashboard                 â”‚
â”‚    (Grafana/Datadog)                    â”‚
â”‚                                         â”‚
â”‚  - Real-time graphs                     â”‚
â”‚  - Alerts on thresholds                 â”‚
â”‚  - Performance trends                   â”‚
â”‚  - Business metrics                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ” Security Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Incoming Request                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Security Middleware                  â”‚
â”‚                                         â”‚
â”‚  1. Input Validation                    â”‚
â”‚     â”œâ”€ Paste content check              â”‚
â”‚     â”œâ”€ File size validation             â”‚
â”‚     â””â”€ File type validation             â”‚
â”‚                                         â”‚
â”‚  2. XSS Prevention                      â”‚
â”‚     â”œâ”€ Content sanitization             â”‚
â”‚     â”œâ”€ HTML escaping                    â”‚
â”‚     â””â”€ CSP headers                      â”‚
â”‚                                         â”‚
â”‚  3. Rate Limiting                       â”‚
â”‚     â”œâ”€ Per IP limit                     â”‚
â”‚     â””â”€ Per user limit                   â”‚
â”‚                                         â”‚
â”‚  4. Authentication (if required)        â”‚
â”‚     â”œâ”€ JWT token validation             â”‚
â”‚     â””â”€ Session verification             â”‚
â”‚                                         â”‚
â”‚  5. Access Control                      â”‚
â”‚     â”œâ”€ Private paste check              â”‚
â”‚     â””â”€ Password verification            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â”œâ”€ Allowed: Continue
               â”‚
               â””â”€ Blocked: Return 403/429
```

## ğŸ¯ Complete Request Lifecycle

```
Time: 0ms    â”Œâ”€ Client sends request
             â”‚
Time: 5ms    â”œâ”€ Load balancer routes
             â”‚
Time: 10ms   â”œâ”€ Rate limiter checks
             â”‚
Time: 15ms   â”œâ”€ Security validation
             â”‚
Time: 20ms   â”œâ”€ Cache lookup (Redis)
             â”‚
Time: 25ms   â”œâ”€ Cache HIT: Return response
             â”‚  OR
             â”‚  Cache MISS: Continue
             â”‚
Time: 50ms   â”œâ”€ Database query (PostgreSQL)
             â”‚
Time: 80ms   â”œâ”€ Fetch from S3 (if needed)
             â”‚
Time: 120ms  â”œâ”€ Syntax highlighting
             â”‚
Time: 150ms  â”œâ”€ Store in cache
             â”‚
Time: 155ms  â”œâ”€ Update analytics (async)
             â”‚
Time: 160ms  â””â”€ Return response to client

Total: ~160ms (cache miss, with highlighting)
Total: ~25ms (cache hit)
```

---

## ğŸ“ Key Takeaways

1. **Multi-level Caching**: Application â†’ Redis â†’ CDN â†’ Database
2. **Async Processing**: Analytics aur updates async mein
3. **Storage Tiering**: Small in DB, large in S3
4. **Syntax Highlighting**: Hybrid approach (server + client)
5. **File Handling**: Multipart uploads for large files
6. **Security**: Multiple layers (encryption, validation, rate limiting)
7. **Scalability**: Horizontal scaling with sharding

---

*Complete flow diagrams for Pastebin system design - ready for implementation!*

