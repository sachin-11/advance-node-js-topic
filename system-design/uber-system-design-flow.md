# Uber System Design - Complete Flow Diagrams

## ğŸ”„ Complete System Flow

### 1. Ride Request Flow (Rider Side)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Rider     â”‚
â”‚  (Mobile)   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 1. Open App
       â”‚ 2. Enter Pickup Location
       â”‚ 3. Enter Drop Location
       â”‚ 4. Select Ride Type
       â”‚ 5. Tap "Request Ride"
       â”‚
       â”‚ POST /api/rides/request
       â”‚ {
       â”‚   pickup: {lat: 28.7, lng: 77.1},
       â”‚   dropoff: {lat: 28.8, lng: 77.2},
       â”‚   ride_type: "uberx",
       â”‚   payment_method: "card"
       â”‚ }
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      Load Balancer                  â”‚
â”‚  (Nginx/HAProxy/AWS ELB)            â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                  â”‚
       â”‚ Round-robin      â”‚
       â–¼                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Web Server â”‚    â”‚  Web Server â”‚
â”‚  Instance 1 â”‚    â”‚  Instance 2 â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚                  â”‚
       â–¼                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Application Server Layer         â”‚
â”‚                                     â”‚
â”‚  1. Validate Request                â”‚
â”‚     â”œâ”€ Check rider authentication   â”‚
â”‚     â”œâ”€ Validate locations           â”‚
â”‚     â”œâ”€ Check payment method          â”‚
â”‚     â””â”€ Rate limiting check           â”‚
â”‚  2. Calculate Estimated Fare        â”‚
â”‚     â”œâ”€ Get distance (Google Maps)   â”‚
â”‚     â”œâ”€ Get duration                 â”‚
â”‚     â”œâ”€ Apply surge pricing          â”‚
â”‚     â””â”€ Calculate base fare           â”‚
â”‚  3. Find Nearby Drivers             â”‚
â”‚     â”œâ”€ Query Redis GeoIndex         â”‚
â”‚     â”œâ”€ Filter by ride type          â”‚
â”‚     â”œâ”€ Filter by availability       â”‚
â”‚     â””â”€ Get top 10 closest           â”‚
â”‚  4. Create Ride Request             â”‚
â”‚     â”œâ”€ Generate ride_id             â”‚
â”‚     â”œâ”€ Set status: "PENDING"         â”‚
â”‚     â””â”€ Store in database             â”‚
â”‚  5. Send Push Notifications         â”‚
â”‚     â”œâ”€ Notify nearby drivers        â”‚
â”‚     â””â”€ Use FCM/APNS                 â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                  â”‚
       â”‚ Write            â”‚ Query
       â–¼                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PostgreSQL  â”‚    â”‚   Redis     â”‚
â”‚  Database   â”‚    â”‚   Cache     â”‚
â”‚             â”‚    â”‚             â”‚
â”‚  Table:     â”‚    â”‚  GeoIndex:  â”‚
â”‚  rides      â”‚    â”‚  drivers    â”‚
â”‚             â”‚    â”‚  location   â”‚
â”‚  ride_id,   â”‚    â”‚             â”‚
â”‚  rider_id,  â”‚    â”‚  Key:       â”‚
â”‚  status,    â”‚    â”‚  driver:123 â”‚
â”‚  pickup,    â”‚    â”‚  Value:     â”‚
â”‚  dropoff    â”‚    â”‚  {lat, lng} â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ Push Notification
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  FCM/APNS   â”‚
â”‚  Service    â”‚
â”‚             â”‚
â”‚  Send to    â”‚
â”‚  Drivers    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. Driver Matching Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Ride Request Created                 â”‚
â”‚    Status: "PENDING"                    â”‚
â”‚    Pickup: {lat: 28.7, lng: 77.1}      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Matching Service                     â”‚
â”‚                                         â”‚
â”‚  1. Get Nearby Drivers                  â”‚
â”‚     â”œâ”€ Query Redis GeoIndex             â”‚
â”‚     â”‚   GEORADIUS drivers               â”‚
â”‚     â”‚   {lat: 28.7, lng: 77.1}          â”‚
â”‚     â”‚   radius: 5km                     â”‚
â”‚     â”œâ”€ Filter by ride_type              â”‚
â”‚     â”œâ”€ Filter by availability           â”‚
â”‚     â””â”€ Sort by distance                 â”‚
â”‚                                         â”‚
â”‚  2. Calculate Driver Scores             â”‚
â”‚     â”œâ”€ Distance score (closer = better) â”‚
â”‚     â”œâ”€ Rating score (higher = better)   â”‚
â”‚     â”œâ”€ Acceptance rate                  â”‚
â”‚     â”œâ”€ Response time                    â”‚
â”‚     â””â”€ Total score = weighted sum       â”‚
â”‚                                         â”‚
â”‚  3. Select Best Driver                  â”‚
â”‚     â”œâ”€ Top scoring driver               â”‚
â”‚     â”œâ”€ Check if driver accepts          â”‚
â”‚     â””â”€ If timeout: Try next driver      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â”‚ Send Match Request
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Driver Notification                  â”‚
â”‚                                         â”‚
â”‚  Push Notification:                     â”‚
â”‚  "New ride request nearby!"             â”‚
â”‚                                         â”‚
â”‚  Data: {                                â”‚
â”‚    ride_id: "ride123",                  â”‚
â”‚    pickup: {lat, lng},                  â”‚
â”‚    dropoff: {lat, lng},                 â”‚
â”‚    fare: "$15.50",                      â”‚
â”‚    distance: "2.5 km",                  â”‚
â”‚    rider_rating: 4.8                    â”‚
â”‚  }                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â”‚ Driver Action
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Driver Response                      â”‚
â”‚                                         â”‚
â”‚  Option 1: ACCEPT                      â”‚
â”‚    â”œâ”€ Update ride status: "ACCEPTED"   â”‚
â”‚    â”œâ”€ Assign driver_id                  â”‚
â”‚    â”œâ”€ Notify rider                      â”‚
â”‚    â””â”€ Start real-time tracking          â”‚
â”‚                                         â”‚
â”‚  Option 2: REJECT                      â”‚
â”‚    â”œâ”€ Remove driver from pool           â”‚
â”‚    â”œâ”€ Try next driver                   â”‚
â”‚    â””â”€ If all reject: Notify rider       â”‚
â”‚                                         â”‚
â”‚  Option 3: TIMEOUT (15 seconds)        â”‚
â”‚    â”œâ”€ Auto-reject                       â”‚
â”‚    â”œâ”€ Try next driver                   â”‚
â”‚    â””â”€ Continue matching                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â”‚ If Accepted
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Update Ride Status                   â”‚
â”‚                                         â”‚
â”‚  Database Update:                       â”‚
â”‚  UPDATE rides SET                       â”‚
â”‚    status = 'ACCEPTED',                 â”‚
â”‚    driver_id = 'driver456',             â”‚
â”‚    matched_at = NOW()                   â”‚
â”‚  WHERE ride_id = 'ride123'              â”‚
â”‚                                         â”‚
â”‚  Cache Update:                          â”‚
â”‚  SET ride:ride123 {                     â”‚
â”‚    status: 'ACCEPTED',                  â”‚
â”‚    driver_id: 'driver456',              â”‚
â”‚    driver_location: {...}               â”‚
â”‚  }                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â”‚ Notify Rider
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Rider Notification                   â”‚
â”‚                                         â”‚
â”‚  Push Notification:                     â”‚
â”‚  "Driver John is on the way!"           â”‚
â”‚                                         â”‚
â”‚  WebSocket Update:                      â”‚
â”‚  {                                      â”‚
â”‚    type: 'RIDE_MATCHED',                â”‚
â”‚    ride_id: 'ride123',                  â”‚
â”‚    driver: {                            â”‚
â”‚      name: 'John',                      â”‚
â”‚      rating: 4.9,                       â”‚
â”‚      vehicle: 'Honda City',             â”‚
â”‚      license: 'DL01AB1234'              â”‚
â”‚    },                                   â”‚
â”‚    eta: '5 minutes'                     â”‚
â”‚  }                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3. Real-Time Location Tracking Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Driver    â”‚                    â”‚    Rider    â”‚
â”‚  (Mobile)   â”‚                    â”‚  (Mobile)   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚                                  â”‚
       â”‚ GPS Updates                      â”‚
       â”‚ Every 5 seconds                  â”‚
       â”‚                                  â”‚
       â”‚ POST /api/drivers/location        â”‚
       â”‚ {                                â”‚
       â”‚   driver_id: "driver456",        â”‚
       â”‚   lat: 28.701,                  â”‚
       â”‚   lng: 77.102,                  â”‚
       â”‚   heading: 45,                   â”‚
       â”‚   speed: 30                     â”‚
       â”‚ }                                â”‚
       â–¼                                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Location Service                     â”‚
â”‚                                         â”‚
â”‚  1. Validate Location                   â”‚
â”‚     â”œâ”€ Check if valid coordinates      â”‚
â”‚     â”œâ”€ Check if driver is on ride      â”‚
â”‚     â””â”€ Rate limiting                    â”‚
â”‚                                         â”‚
â”‚  2. Update Redis GeoIndex               â”‚
â”‚     GEOADD drivers                      â”‚
â”‚     driver456 77.102 28.701             â”‚
â”‚                                         â”‚
â”‚  3. Update Driver Cache                 â”‚
â”‚     SET driver:driver456:location {     â”‚
â”‚       lat: 28.701,                      â”‚
â”‚       lng: 77.102,                      â”‚
â”‚       timestamp: 1234567890,            â”‚
â”‚       heading: 45,                       â”‚
â”‚       speed: 30                          â”‚
â”‚     }                                   â”‚
â”‚                                         â”‚
â”‚  4. Check Active Rides                  â”‚
â”‚     â”œâ”€ Get driver's active ride         â”‚
â”‚     â”œâ”€ If ride exists:                  â”‚
â”‚     â”‚   â”œâ”€ Update ride location        â”‚
â”‚     â”‚   â”œâ”€ Calculate ETA                â”‚
â”‚     â”‚   â””â”€ Publish to WebSocket         â”‚
â”‚     â””â”€ If no ride: Just update cache    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                  â”‚
       â”‚ Update           â”‚ Publish
       â–¼                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Redis     â”‚    â”‚  WebSocket  â”‚
â”‚   GeoIndex  â”‚    â”‚   Server    â”‚
â”‚             â”‚    â”‚             â”‚
â”‚  Real-time  â”‚    â”‚  Publish to â”‚
â”‚  Location   â”‚    â”‚  Channels:  â”‚
â”‚  Data       â”‚    â”‚  - ride:123 â”‚
â”‚             â”‚    â”‚  - rider:789 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â”‚ WebSocket Push
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Rider App (Real-time Updates)        â”‚
â”‚                                         â”‚
â”‚  WebSocket Message:                     â”‚
â”‚  {                                      â”‚
â”‚    type: 'LOCATION_UPDATE',             â”‚
â”‚    ride_id: 'ride123',                  â”‚
â”‚    driver_location: {                   â”‚
â”‚      lat: 28.701,                        â”‚
â”‚      lng: 77.102,                        â”‚
â”‚      heading: 45,                        â”‚
â”‚      speed: 30                           â”‚
â”‚    },                                   â”‚
â”‚    eta: '3 minutes',                    â”‚
â”‚    distance: '1.2 km'                   â”‚
â”‚  }                                      â”‚
â”‚                                         â”‚
â”‚  Map Updates:                           â”‚
â”‚  - Driver marker moves                  â”‚
â”‚  - ETA updates                          â”‚
â”‚  - Route recalculation                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4. Ride Status Flow (Complete Journey)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Ride Lifecycle States                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. PENDING                             â”‚
â”‚     - Ride requested                    â”‚
â”‚     - Waiting for driver match          â”‚
â”‚     - Can be cancelled                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚ Driver Accepts
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  2. ACCEPTED                            â”‚
â”‚     - Driver assigned                   â”‚
â”‚     - Driver heading to pickup          â”‚
â”‚     - Real-time tracking active         â”‚
â”‚     - Can be cancelled (with fee)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚ Driver Arrives at Pickup
               â”‚ (GPS proximity check)
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  3. ARRIVED                             â”‚
â”‚     - Driver at pickup location         â”‚
â”‚     - Rider notified                    â”‚
â”‚     - Waiting for rider                 â”‚
â”‚     - Timer starts (2 min wait)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚ Driver Starts Ride
               â”‚ (Button: "Start Ride")
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  4. IN_PROGRESS                         â”‚
â”‚     - Ride started                      â”‚
â”‚     - Real-time tracking active          â”‚
â”‚     - Route tracking                    â”‚
â”‚     - Distance calculation              â”‚
â”‚     - Fare calculation (live)           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚ Driver Arrives at Dropoff
               â”‚ (GPS proximity check)
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  5. COMPLETED                           â”‚
â”‚     - Ride finished                     â”‚
â”‚     - Final fare calculated              â”‚
â”‚     - Payment processed                  â”‚
â”‚     - Rating prompt shown                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  6. CANCELLED (Can happen at any stage) â”‚
â”‚     - Cancellation fee (if applicable)   â”‚
â”‚     - Refund processed                   â”‚
â”‚     - Notification sent                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5. Payment Processing Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Ride Completed                       â”‚
â”‚    Status: "COMPLETED"                  â”‚
â”‚    Final Distance: 5.2 km               â”‚
â”‚    Duration: 15 minutes                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Fare Calculation Service             â”‚
â”‚                                         â”‚
â”‚  1. Calculate Base Fare                 â”‚
â”‚     â”œâ”€ Base fare: $2.50                â”‚
â”‚     â”œâ”€ Per km: $1.20 Ã— 5.2 = $6.24    â”‚
â”‚     â”œâ”€ Per minute: $0.25 Ã— 15 = $3.75  â”‚
â”‚     â””â”€ Subtotal: $12.49                â”‚
â”‚                                         â”‚
â”‚  2. Apply Surge Pricing                 â”‚
â”‚     â”œâ”€ Check surge multiplier: 1.5x    â”‚
â”‚     â””â”€ Surge fare: $12.49 Ã— 1.5 = $18.74â”‚
â”‚                                         â”‚
â”‚  3. Apply Discounts/Promotions          â”‚
â”‚     â”œâ”€ Check rider coupons              â”‚
â”‚     â”œâ”€ Apply discount: -$2.00          â”‚
â”‚     â””â”€ Final fare: $16.74              â”‚
â”‚                                         â”‚
â”‚  4. Calculate Split                     â”‚
â”‚     â”œâ”€ Uber commission: 25% = $4.19    â”‚
â”‚     â”œâ”€ Driver earnings: 75% = $12.55    â”‚
â”‚     â””â”€ Total: $16.74                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â”‚ Process Payment
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Payment Service                      â”‚
â”‚                                         â”‚
â”‚  1. Get Payment Method                  â”‚
â”‚     â”œâ”€ Check rider's default method    â”‚
â”‚     â”œâ”€ Card: "card_1234"                â”‚
â”‚     â””â”€ Get card details (encrypted)     â”‚
â”‚                                         â”‚
â”‚  2. Charge Payment Gateway              â”‚
â”‚     â”œâ”€ Stripe/PayPal/Braintree         â”‚
â”‚     â”œâ”€ Amount: $16.74                  â”‚
â”‚     â”œâ”€ Currency: USD                    â”‚
â”‚     â””â”€ Description: "Uber Ride"         â”‚
â”‚                                         â”‚
â”‚  3. Handle Payment Response             â”‚
â”‚     â”œâ”€ SUCCESS:                        â”‚
â”‚     â”‚   â”œâ”€ Create payment record       â”‚
â”‚     â”‚   â”œâ”€ Update ride status          â”‚
â”‚     â”‚   â”œâ”€ Send receipt                â”‚
â”‚     â”‚   â””â”€ Transfer to driver           â”‚
â”‚     â”‚                                   â”‚
â”‚     â””â”€ FAILURE:                        â”‚
â”‚         â”œâ”€ Retry (3 attempts)          â”‚
â”‚         â”œâ”€ Notify rider                â”‚
â”‚         â””â”€ Hold ride (if needed)       â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                  â”‚
       â”‚ Charge           â”‚ Record
       â–¼                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Payment    â”‚    â”‚ PostgreSQL  â”‚
â”‚  Gateway    â”‚    â”‚  Database   â”‚
â”‚  (Stripe)   â”‚    â”‚             â”‚
â”‚             â”‚    â”‚  Table:     â”‚
â”‚  Process    â”‚    â”‚  payments   â”‚
â”‚  Payment    â”‚    â”‚             â”‚
â”‚             â”‚    â”‚  payment_id,â”‚
â”‚  Return:    â”‚    â”‚  ride_id,   â”‚
â”‚  {          â”‚    â”‚  amount,    â”‚
â”‚    success: â”‚    â”‚  status,    â”‚
â”‚    true,    â”‚    â”‚  method     â”‚
â”‚    tx_id:   â”‚    â”‚             â”‚
â”‚    "tx_123" â”‚    â”‚             â”‚
â”‚  }          â”‚    â”‚             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ If Success
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Driver Payout Service                â”‚
â”‚                                         â”‚
â”‚  1. Calculate Driver Earnings           â”‚
â”‚     â”œâ”€ Base: $12.55                    â”‚
â”‚     â”œâ”€ Tips: $2.00                     â”‚
â”‚     â””â”€ Total: $14.55                   â”‚
â”‚                                         â”‚
â”‚  2. Add to Driver Wallet                â”‚
â”‚     â”œâ”€ Update driver balance            â”‚
â”‚     â”œâ”€ Create transaction record        â”‚
â”‚     â””â”€ Weekly payout (if configured)    â”‚
â”‚                                         â”‚
â”‚  3. Send Notification                   â”‚
â”‚     â”œâ”€ Notify driver                    â”‚
â”‚     â””â”€ "You earned $14.55!"            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Receipt Generation                   â”‚
â”‚                                         â”‚
â”‚  Email/SMS Receipt:                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ Uber Receipt                 â”‚       â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤       â”‚
â”‚  â”‚ Ride ID: ride123            â”‚       â”‚
â”‚  â”‚ Date: Dec 7, 2024          â”‚       â”‚
â”‚  â”‚                             â”‚       â”‚
â”‚  â”‚ Base Fare:        $2.50    â”‚       â”‚
â”‚  â”‚ Distance (5.2km): $6.24    â”‚       â”‚
â”‚  â”‚ Time (15min):     $3.75    â”‚       â”‚
â”‚  â”‚ Surge (1.5x):     $6.25    â”‚       â”‚
â”‚  â”‚ Discount:        -$2.00    â”‚       â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤       â”‚
â”‚  â”‚ Total:           $16.74    â”‚       â”‚
â”‚  â”‚ Payment: Card ****1234      â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6. Surge Pricing Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Location: Downtown Area              â”‚
â”‚    Time: Friday 6 PM (Rush Hour)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Surge Pricing Service                â”‚
â”‚    (Runs every 1 minute)                â”‚
â”‚                                         â”‚
â”‚  1. Calculate Demand                    â”‚
â”‚     â”œâ”€ Count active ride requests       â”‚
â”‚     â”‚   SELECT COUNT(*)                 â”‚
â”‚     â”‚   FROM rides                      â”‚
â”‚     â”‚   WHERE status = 'PENDING'        â”‚
â”‚     â”‚   AND pickup_area = 'downtown'    â”‚
â”‚     â”‚   AND created_at > NOW() - 5min   â”‚
â”‚     â”‚   Result: 45 requests             â”‚
â”‚                                         â”‚
â”‚  2. Calculate Supply                    â”‚
â”‚     â”œâ”€ Count available drivers          â”‚
â”‚     â”‚   GEOCOUNT drivers                â”‚
â”‚     â”‚   {lat, lng} radius 5km          â”‚
â”‚     â”‚   WHERE status = 'AVAILABLE'      â”‚
â”‚     â”‚   Result: 12 drivers             â”‚
â”‚                                         â”‚
â”‚  3. Calculate Demand/Supply Ratio       â”‚
â”‚     â”œâ”€ Ratio: 45 / 12 = 3.75           â”‚
â”‚     â”œâ”€ Normal ratio: 1.0                â”‚
â”‚     â””â”€ Surge needed: YES                â”‚
â”‚                                         â”‚
â”‚  4. Calculate Surge Multiplier         â”‚
â”‚     â”œâ”€ Base multiplier: 1.0x            â”‚
â”‚     â”œâ”€ Ratio 2.0 â†’ 1.5x                â”‚
â”‚     â”œâ”€ Ratio 3.0 â†’ 2.0x                â”‚
â”‚     â”œâ”€ Ratio 4.0 â†’ 2.5x                â”‚
â”‚     â””â”€ Current: 3.75 â†’ 2.3x            â”‚
â”‚                                         â”‚
â”‚  5. Apply Geographic Boundaries         â”‚
â”‚     â”œâ”€ Divide city into zones           â”‚
â”‚     â”œâ”€ Each zone has own surge          â”‚
â”‚     â””â”€ Smooth transitions               â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                  â”‚
       â”‚ Update           â”‚ Cache
       â–¼                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PostgreSQL  â”‚    â”‚   Redis     â”‚
â”‚  Database   â”‚    â”‚   Cache     â”‚
â”‚             â”‚    â”‚             â”‚
â”‚  Table:     â”‚    â”‚  Key:       â”‚
â”‚  surge_zonesâ”‚    â”‚  surge:zone:â”‚
â”‚             â”‚    â”‚  downtown   â”‚
â”‚  zone_id,   â”‚    â”‚  Value:     â”‚
â”‚  multiplier,â”‚    â”‚  {          â”‚
â”‚  updated_at â”‚    â”‚    multiplier:â”‚
â”‚             â”‚    â”‚    2.3,     â”‚
â”‚             â”‚    â”‚    expires: â”‚
â”‚             â”‚    â”‚    60s      â”‚
â”‚             â”‚    â”‚  }          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ Display to Users
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    User Interface Updates               â”‚
â”‚                                         â”‚
â”‚  Rider App:                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ Surge Pricing Active        â”‚       â”‚
â”‚  â”‚ 2.3x                        â”‚       â”‚
â”‚  â”‚                             â”‚       â”‚
â”‚  â”‚ Estimated Fare: $38.50      â”‚       â”‚
â”‚  â”‚ (Normally $16.74)           â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                         â”‚
â”‚  Driver App:                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ High Demand Area            â”‚       â”‚
â”‚  â”‚ 2.3x Earnings               â”‚       â”‚
â”‚  â”‚                             â”‚       â”‚
â”‚  â”‚ Go to Downtown              â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7. Driver Availability Management Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Driver    â”‚
â”‚  (Mobile)   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ Driver Opens App
       â”‚ Taps "Go Online"
       â”‚
       â”‚ POST /api/drivers/go-online
       â”‚ {
       â”‚   driver_id: "driver456",
       â”‚   location: {lat: 28.7, lng: 77.1},
       â”‚   vehicle_type: "uberx"
       â”‚ }
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Application Server               â”‚
â”‚                                     â”‚
â”‚  1. Validate Driver                 â”‚
â”‚     â”œâ”€ Check driver status          â”‚
â”‚     â”œâ”€ Verify documents             â”‚
â”‚     â”œâ”€ Check vehicle registration   â”‚
â”‚     â””â”€ Validate insurance           â”‚
â”‚  2. Update Driver Status            â”‚
â”‚     â”œâ”€ Set status: "AVAILABLE"      â”‚
â”‚     â”œâ”€ Update location              â”‚
â”‚     â””â”€ Add to GeoIndex              â”‚
â”‚  3. Add to Available Pool            â”‚
â”‚     â”œâ”€ Add to Redis GeoIndex        â”‚
â”‚     â”œâ”€ Set availability flag         â”‚
â”‚     â””â”€ Start location updates       â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                  â”‚
       â”‚ Update           â”‚ GeoIndex
       â–¼                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PostgreSQL  â”‚    â”‚   Redis     â”‚
â”‚  Database   â”‚    â”‚   GeoIndex  â”‚
â”‚             â”‚    â”‚             â”‚
â”‚  Table:     â”‚    â”‚  GEOADD     â”‚
â”‚  drivers    â”‚    â”‚  drivers    â”‚
â”‚             â”‚    â”‚  driver456  â”‚
â”‚  driver_id, â”‚    â”‚  77.1 28.7  â”‚
â”‚  status,    â”‚    â”‚             â”‚
â”‚  location,  â”‚    â”‚  Available  â”‚
â”‚  updated_at â”‚    â”‚  drivers    â”‚
â”‚             â”‚    â”‚  pool       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ Location Updates (Every 5s)
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Continuous Location Updates           â”‚
â”‚                                         â”‚
â”‚  While status = "AVAILABLE":            â”‚
â”‚    â”œâ”€ GPS sends location                â”‚
â”‚    â”œâ”€ Update Redis GeoIndex             â”‚
â”‚    â”œâ”€ Update driver cache               â”‚
â”‚    â””â”€ Check for nearby requests         â”‚
â”‚                                         â”‚
â”‚  When Ride Matched:                     â”‚
â”‚    â”œâ”€ Status: "ON_RIDE"                 â”‚
â”‚    â”œâ”€ Remove from available pool        â”‚
â”‚    â””â”€ Continue location updates         â”‚
â”‚                                         â”‚
â”‚  When Ride Completed:                   â”‚
â”‚    â”œâ”€ Status: "AVAILABLE"               â”‚
â”‚    â”œâ”€ Add back to pool                  â”‚
â”‚    â””â”€ Continue matching                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 8. Route Optimization Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Multiple Ride Requests                â”‚
â”‚    Same Area, Similar Routes            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Route Optimization Service            â”‚
â”‚                                         â”‚
â”‚  1. Group Similar Rides                  â”‚
â”‚     â”œâ”€ Find rides with:                â”‚
â”‚     â”‚   - Same pickup area              â”‚
â”‚     â”‚   - Similar dropoff area          â”‚
â”‚     â”‚   - Within 2km radius             â”‚
â”‚     â”œâ”€ Cluster rides                    â”‚
â”‚     â””â”€ Create route groups              â”‚
â”‚                                         â”‚
â”‚  2. Calculate Optimal Route             â”‚
â”‚     â”œâ”€ Use Google Maps API             â”‚
â”‚     â”œâ”€ Consider traffic                 â”‚
â”‚     â”œâ”€ Minimize total distance          â”‚
â”‚     â”œâ”€ Minimize total time              â”‚
â”‚     â””â”€ Balance both                     â”‚
â”‚                                         â”‚
â”‚  3. Assign Driver                        â”‚
â”‚     â”œâ”€ Find driver for route            â”‚
â”‚     â”œâ”€ Check capacity                   â”‚
â”‚     â””â”€ Match driver to route            â”‚
â”‚                                         â”‚
â”‚  4. Update Ride Routes                   â”‚
â”‚     â”œâ”€ Set waypoints                    â”‚
â”‚     â”œâ”€ Calculate ETAs                   â”‚
â”‚     â””â”€ Notify riders                    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                  â”‚
       â”‚ Route            â”‚ Maps API
       â–¼                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PostgreSQL  â”‚    â”‚  Google     â”‚
â”‚  Database   â”‚    â”‚  Maps API   â”‚
â”‚             â”‚    â”‚             â”‚
â”‚  Store      â”‚    â”‚  Directions â”‚
â”‚  optimized  â”‚    â”‚  API        â”‚
â”‚  routes     â”‚    â”‚             â”‚
â”‚             â”‚    â”‚  Returns:   â”‚
â”‚             â”‚    â”‚  - Route    â”‚
â”‚             â”‚    â”‚  - Distance â”‚
â”‚             â”‚    â”‚  - Duration â”‚
â”‚             â”‚    â”‚  - Waypointsâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 9. Rating & Review Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Ride Completed                       â”‚
â”‚    Status: "COMPLETED"                  â”‚
â”‚    Payment: "SUCCESS"                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â”‚ Trigger Rating Prompt
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Rating Service                       â”‚
â”‚                                         â”‚
â”‚  1. Send Rating Prompt                  â”‚
â”‚     â”œâ”€ Push notification to rider       â”‚
â”‚     â”œâ”€ In-app notification              â”‚
â”‚     â””â”€ "Rate your ride!"                â”‚
â”‚                                         â”‚
â”‚  2. Rider Submits Rating                â”‚
â”‚     â”œâ”€ Rating: 1-5 stars                â”‚
â”‚     â”œâ”€ Optional: Written review         â”‚
â”‚     â”œâ”€ Optional: Tags (clean, polite)   â”‚
â”‚     â””â”€ Submit rating                    â”‚
â”‚                                         â”‚
â”‚  3. Store Rating                        â”‚
â”‚     â”œâ”€ Save to database                 â”‚
â”‚     â”œâ”€ Update driver's average          â”‚
â”‚     â”œâ”€ Update rider's rating history    â”‚
â”‚     â””â”€ Trigger notifications            â”‚
â”‚                                         â”‚
â”‚  4. Driver Rating (Optional)             â”‚
â”‚     â”œâ”€ Driver can rate rider            â”‚
â”‚     â”œâ”€ Affects rider's rating          â”‚
â”‚     â””â”€ Used for matching                â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                  â”‚
       â”‚ Store            â”‚ Update
       â–¼                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PostgreSQL  â”‚    â”‚   Redis     â”‚
â”‚  Database   â”‚    â”‚   Cache     â”‚
â”‚             â”‚    â”‚             â”‚
â”‚  Table:     â”‚    â”‚  Update     â”‚
â”‚  ratings    â”‚    â”‚  driver     â”‚
â”‚             â”‚    â”‚  cache      â”‚
â”‚  rating_id, â”‚    â”‚             â”‚
â”‚  ride_id,   â”‚    â”‚  driver:456 â”‚
â”‚  driver_id, â”‚    â”‚  rating:    â”‚
â”‚  rider_id,  â”‚    â”‚  4.8        â”‚
â”‚  rating,    â”‚    â”‚             â”‚
â”‚  review,    â”‚    â”‚             â”‚
â”‚  tags       â”‚    â”‚             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ Calculate New Average
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Rating Calculation                   â”‚
â”‚                                         â”‚
â”‚  Driver's New Average:                  â”‚
â”‚  â”œâ”€ Previous: 4.7 (100 ratings)        â”‚
â”‚  â”œâ”€ New rating: 5.0                     â”‚
â”‚  â”œâ”€ Calculation:                        â”‚
â”‚  â”‚   (4.7 Ã— 100 + 5.0) / 101           â”‚
â”‚  â”‚   = 4.702                           â”‚
â”‚  â””â”€ Update driver profile               â”‚
â”‚                                         â”‚
â”‚  Impact on Matching:                    â”‚
â”‚  â”œâ”€ Higher rated drivers prioritized    â”‚
â”‚  â”œâ”€ Low rated drivers deprioritized     â”‚
â”‚  â””â”€ Very low (< 4.0) may be suspended   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 10. Cancellation Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Cancellation Request                 â”‚
â”‚    Can be initiated by:                 â”‚
â”‚    - Rider                              â”‚
â”‚    - Driver                             â”‚
â”‚    - System (timeout)                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Cancellation Service                 â”‚
â”‚                                         â”‚
â”‚  1. Validate Cancellation               â”‚
â”‚     â”œâ”€ Check ride status                â”‚
â”‚     â”œâ”€ Check cancellation reason        â”‚
â”‚     â”œâ”€ Check time since request         â”‚
â”‚     â””â”€ Determine cancellation fee       â”‚
â”‚                                         â”‚
â”‚  2. Calculate Cancellation Fee          â”‚
â”‚     â”œâ”€ If cancelled within 2 min:       â”‚
â”‚     â”‚   â””â”€ No fee                      â”‚
â”‚     â”œâ”€ If cancelled after 2 min:        â”‚
â”‚     â”‚   â””â”€ Fee: $5.00                  â”‚
â”‚     â”œâ”€ If driver already arrived:        â”‚
â”‚     â”‚   â””â”€ Fee: $10.00                 â”‚
â”‚     â””â”€ If driver started ride:          â”‚
â”‚         â””â”€ Full fare                    â”‚
â”‚                                         â”‚
â”‚  3. Process Cancellation                â”‚
â”‚     â”œâ”€ Update ride status: "CANCELLED"  â”‚
â”‚     â”œâ”€ Charge cancellation fee          â”‚
â”‚     â”œâ”€ Refund remaining amount          â”‚
â”‚     â”œâ”€ Notify both parties              â”‚
â”‚     â””â”€ Release driver (if needed)       â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                  â”‚
       â”‚ Update           â”‚ Charge/Refund
       â–¼                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PostgreSQL  â”‚    â”‚  Payment    â”‚
â”‚  Database   â”‚    â”‚  Gateway    â”‚
â”‚             â”‚    â”‚             â”‚
â”‚  Update     â”‚    â”‚  Charge     â”‚
â”‚  ride       â”‚    â”‚  fee or     â”‚
â”‚  status     â”‚    â”‚  refund     â”‚
â”‚             â”‚    â”‚             â”‚
â”‚  Record     â”‚    â”‚             â”‚
â”‚  cancellationâ”‚    â”‚             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ Notify
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Notifications                        â”‚
â”‚                                         â”‚
â”‚  To Rider:                              â”‚
â”‚  "Ride cancelled. Cancellation fee: $5" â”‚
â”‚                                         â”‚
â”‚  To Driver:                             â”‚
â”‚  "Ride cancelled. You're back online."  â”‚
â”‚                                         â”‚
â”‚  If Driver Cancelled:                   â”‚
â”‚  "Finding you another driver..."        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 11. Complete Request Lifecycle Timeline

```
Time: 0s      â”Œâ”€ Rider opens app
              â”‚
Time: 2s      â”œâ”€ Rider enters pickup/dropoff
              â”‚
Time: 5s      â”œâ”€ Rider taps "Request Ride"
              â”‚
Time: 6s      â”œâ”€ System calculates fare
              â”‚
Time: 7s      â”œâ”€ System finds nearby drivers
              â”‚
Time: 8s      â”œâ”€ Push notification to drivers
              â”‚
Time: 10s     â”œâ”€ Driver 1 receives notification
              â”‚
Time: 12s     â”œâ”€ Driver 1 accepts ride
              â”‚
Time: 13s     â”œâ”€ Rider notified: "Driver matched!"
              â”‚
Time: 14s     â”œâ”€ Real-time tracking starts
              â”‚
Time: 15s     â”œâ”€ Driver location updates begin
              â”‚  (Every 5 seconds)
              â”‚
Time: 3min    â”œâ”€ Driver arrives at pickup
              â”‚
Time: 3min    â”œâ”€ Status: "ARRIVED"
              â”‚
Time: 5min    â”œâ”€ Driver starts ride
              â”‚
Time: 5min    â”œâ”€ Status: "IN_PROGRESS"
              â”‚
Time: 20min   â”œâ”€ Driver arrives at dropoff
              â”‚
Time: 20min   â”œâ”€ Status: "COMPLETED"
              â”‚
Time: 21min   â”œâ”€ Fare calculated
              â”‚
Time: 22min   â”œâ”€ Payment processed
              â”‚
Time: 23min   â”œâ”€ Receipt sent
              â”‚
Time: 24min   â”œâ”€ Rating prompt shown
              â”‚
Time: 25min   â””â”€ Ride fully completed

Total Duration: ~25 minutes
```

### 12. Database Schema Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Core Tables                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      users          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ user_id (PK)        â”‚
â”‚ phone_number        â”‚
â”‚ email               â”‚
â”‚ name                â”‚
â”‚ rating              â”‚
â”‚ created_at          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      drivers        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ driver_id (PK)      â”‚
â”‚ user_id (FK)        â”‚
â”‚ license_number      â”‚
â”‚ vehicle_type        â”‚
â”‚ vehicle_model       â”‚
â”‚ status              â”‚
â”‚ current_location    â”‚
â”‚ rating              â”‚
â”‚ is_online           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      rides          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ride_id (PK)        â”‚
â”‚ rider_id (FK)       â”‚
â”‚ driver_id (FK)      â”‚
â”‚ pickup_location     â”‚
â”‚ dropoff_location    â”‚
â”‚ status              â”‚
â”‚ fare                â”‚
â”‚ distance            â”‚
â”‚ duration            â”‚
â”‚ requested_at        â”‚
â”‚ started_at          â”‚
â”‚ completed_at        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     payments        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ payment_id (PK)     â”‚
â”‚ ride_id (FK)        â”‚
â”‚ rider_id (FK)       â”‚
â”‚ amount              â”‚
â”‚ payment_method      â”‚
â”‚ status              â”‚
â”‚ transaction_id      â”‚
â”‚ created_at          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     ratings         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ rating_id (PK)      â”‚
â”‚ ride_id (FK)        â”‚
â”‚ driver_id (FK)      â”‚
â”‚ rider_id (FK)       â”‚
â”‚ rating              â”‚
â”‚ review              â”‚
â”‚ created_at          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 13. Real-Time Communication Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Rider     â”‚                    â”‚   Driver    â”‚
â”‚  (Mobile)   â”‚                    â”‚  (Mobile)   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚                                  â”‚
       â”‚ WebSocket Connection             â”‚ WebSocket Connection
       â”‚ wss://api.uber.com/ws            â”‚ wss://api.uber.com/ws
       â”‚                                  â”‚
       â–¼                                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         WebSocket Server Cluster                    â”‚
â”‚         (Socket.io / SockJS)                       â”‚
â”‚                                                     â”‚
â”‚  Connection Management:                             â”‚
â”‚  â”œâ”€ Maintain persistent connections                 â”‚
â”‚  â”œâ”€ Heartbeat (ping/pong)                          â”‚
â”‚  â”œâ”€ Reconnection handling                          â”‚
â”‚  â””â”€ Load balancing                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚                  â”‚
               â”‚ Subscribe        â”‚ Subscribe
               â–¼                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Redis Pub/Sub      â”‚  â”‚  Redis Pub/Sub      â”‚
â”‚                     â”‚  â”‚                     â”‚
â”‚  Channels:          â”‚  â”‚  Channels:          â”‚
â”‚  - ride:ride123     â”‚  â”‚  - driver:driver456 â”‚
â”‚  - rider:rider789   â”‚  â”‚  - ride:ride123     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
               â”‚                        â”‚
               â”‚ Publish Events         â”‚
               â–¼                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Event Publishers                            â”‚
â”‚                                                     â”‚
â”‚  Location Service â†’ ride:ride123                    â”‚
â”‚  Matching Service â†’ ride:ride123                    â”‚
â”‚  Payment Service â†’ ride:ride123                     â”‚
â”‚  Rating Service â†’ ride:ride123                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Real-Time Events:
â”œâ”€ RIDE_MATCHED: Driver assigned
â”œâ”€ LOCATION_UPDATE: Driver location changed
â”œâ”€ RIDE_STATUS_CHANGED: Status update
â”œâ”€ ETA_UPDATE: Estimated arrival time
â”œâ”€ PAYMENT_PROCESSED: Payment completed
â””â”€ RATING_RECEIVED: New rating
```

### 14. Scalability Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Load Balancer                   â”‚
â”‚      (AWS ELB / Nginx)                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”
       â”‚               â”‚
       â–¼               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Region 1 â”‚   â”‚  Region 2 â”‚
â”‚  (US)     â”‚   â”‚  (India)  â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
      â”‚               â”‚
      â–¼               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Application Servers                  â”‚
â”‚    (Auto-scaling groups)                â”‚
â”‚                                         â”‚
â”‚  â”œâ”€ API Servers (REST)                 â”‚
â”‚  â”œâ”€ WebSocket Servers                  â”‚
â”‚  â”œâ”€ Matching Service                   â”‚
â”‚  â”œâ”€ Payment Service                    â”‚
â”‚  â””â”€ Location Service                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”
       â”‚               â”‚
       â–¼               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Redis    â”‚   â”‚ PostgreSQL â”‚
â”‚  Cluster  â”‚   â”‚  Cluster   â”‚
â”‚           â”‚   â”‚            â”‚
â”‚  GeoIndex â”‚   â”‚  Master-   â”‚
â”‚  Cache    â”‚   â”‚  Slave     â”‚
â”‚  Pub/Sub  â”‚   â”‚  Replicationâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Compute Optimized (C5, C6i)                            â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  Use Case: CPU-intensive tasks                          â”‚
â”‚                                                          â”‚
â”‚  Examples:                                               â”‚
â”‚  â”œâ”€ c5.large:  2 vCPU, 4 GB RAM    â†’ Light compute     â”‚
â”‚  â”œâ”€ c5.xlarge: 4 vCPU, 8 GB RAM    â†’ Medium compute    â”‚
â”‚  â””â”€ c5.2xlarge: 8 vCPU, 16 GB RAM â†’ Heavy compute      â”‚
â”‚                                                          â”‚
â”‚  For Uber:                                               â”‚
â”‚  â”œâ”€ Route Optimization: c5.xlarge                       â”‚
â”‚  â”œâ”€ Fare Calculation: c5.large                          â”‚
â”‚  â””â”€ Surge Pricing Engine: c5.xlarge                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Memory Optimized (R5, R6i)                             â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  Use Case: In-memory databases, caching                 â”‚
â”‚                                                          â”‚
â”‚  Examples:                                               â”‚
â”‚  â”œâ”€ r5.large:  2 vCPU, 16 GB RAM   â†’ Small cache       â”‚
â”‚  â”œâ”€ r5.xlarge: 4 vCPU, 32 GB RAM   â†’ Medium cache      â”‚
â”‚  â”œâ”€ r5.2xlarge: 8 vCPU, 64 GB RAM  â†’ Large cache       â”‚
â”‚  â””â”€ r5.4xlarge: 16 vCPU, 128 GB RAM â†’ Very large cache â”‚
â”‚                                                          â”‚
â”‚  For Uber:                                               â”‚
â”‚  â”œâ”€ Redis Cache: r5.xlarge (32 GB)                      â”‚
â”‚  â”œâ”€ Redis GeoIndex: r5.2xlarge (64 GB)                 â”‚
â”‚  â””â”€ In-Memory Session Store: r5.large (16 GB)          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Burstable Performance (T3, T4g)                        â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  Use Case: Variable workloads, dev/test                 â”‚
â”‚                                                          â”‚
â”‚  Examples:                                               â”‚
â”‚  â”œâ”€ t3.micro:  2 vCPU, 1 GB RAM    â†’ Free tier          â”‚
â”‚  â”œâ”€ t3.small:  2 vCPU, 2 GB RAM    â†’ Dev                â”‚
â”‚  â””â”€ t3.medium: 2 vCPU, 4 GB RAM   â†’ Small prod         â”‚
â”‚                                                          â”‚
â”‚  For Uber:                                               â”‚
â”‚  â”œâ”€ Development: t3.medium                               â”‚
â”‚  â”œâ”€ Staging: t3.large                                    â”‚
â”‚  â””â”€ Background Workers: t3.medium                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Uber System Instance Mapping

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Component              â”‚ Instance Type â”‚ Count â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ API Servers               â”‚ m5.xlarge     â”‚ 10-50 â”‚
â”‚ WebSocket Servers         â”‚ m5.2xlarge    â”‚ 5-20  â”‚
â”‚ Matching Service          â”‚ m5.2xlarge    â”‚ 3-10  â”‚
â”‚ Payment Service           â”‚ m5.xlarge     â”‚ 3-10  â”‚
â”‚ Location Service          â”‚ c5.xlarge     â”‚ 5-15  â”‚
â”‚ Route Optimization        â”‚ c5.xlarge     â”‚ 2-5   â”‚
â”‚ Surge Pricing Engine      â”‚ c5.large      â”‚ 2-5   â”‚
â”‚ Redis Cache               â”‚ r5.xlarge     â”‚ 3-6   â”‚
â”‚ Redis GeoIndex            â”‚ r5.2xlarge   â”‚ 3-6   â”‚
â”‚ Background Workers        â”‚ t3.medium     â”‚ 5-10  â”‚
â”‚ Monitoring/Logging        â”‚ t3.large      â”‚ 2-3   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. Auto Scaling

Auto Scaling automatically instances add/remove karta hai based on demand.

#### Auto Scaling Components

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Auto Scaling Architecture                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Launch Template                                         â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  Defines:                                                â”‚
â”‚  â”œâ”€ AMI (Amazon Machine Image)                          â”‚
â”‚  â”œâ”€ Instance Type (m5.xlarge)                           â”‚
â”‚  â”œâ”€ Security Groups                                     â”‚
â”‚  â”œâ”€ User Data (startup script)                          â”‚
â”‚  â”œâ”€ IAM Role                                            â”‚
â”‚  â””â”€ Storage Configuration                               â”‚
â”‚                                                          â”‚
â”‚  Example:                                                â”‚
â”‚  {                                                       â”‚
â”‚    "ImageId": "ami-0abc123",                            â”‚
â”‚    "InstanceType": "m5.xlarge",                         â”‚
â”‚    "SecurityGroupIds": ["sg-12345"],                    â”‚
â”‚    "UserData": "#!/bin/bash\nnpm start",                â”‚
â”‚    "IamInstanceProfile": "UberAPIRole"                  â”‚
â”‚  }                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Auto Scaling Group (ASG)                               â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  Configuration:                                          â”‚
â”‚  â”œâ”€ Min Size: 3 instances                               â”‚
â”‚  â”œâ”€ Desired Capacity: 5 instances                       â”‚
â”‚  â”œâ”€ Max Size: 20 instances                              â”‚
â”‚  â”œâ”€ Launch Template: api-server-template                â”‚
â”‚  â”œâ”€ VPC: vpc-uber-production                            â”‚
â”‚  â”œâ”€ Subnets: [subnet-1a, subnet-1b, subnet-1c]         â”‚
â”‚  â””â”€ Health Check: ELB health check                      â”‚
â”‚                                                          â”‚
â”‚  Scaling Policies:                                       â”‚
â”‚  â”œâ”€ Scale Out: Add instances when CPU > 70%            â”‚
â”‚  â”œâ”€ Scale In: Remove instances when CPU < 30%            â”‚
â”‚  â””â”€ Cooldown: 300 seconds                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Scaling Policies                                       â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                          â”‚
â”‚  1. Target Tracking Scaling                             â”‚
â”‚     â”œâ”€ Maintain CPU at 50%                              â”‚
â”‚     â”œâ”€ Automatically add/remove instances               â”‚
â”‚     â””â”€ Best for steady workloads                        â”‚
â”‚                                                          â”‚
â”‚  2. Step Scaling                                        â”‚
â”‚     â”œâ”€ CPU 50-70%: Add 1 instance                      â”‚
â”‚     â”œâ”€ CPU 70-90%: Add 2 instances                     â”‚
â”‚     â”œâ”€ CPU > 90%: Add 3 instances                      â”‚
â”‚     â””â”€ More granular control                            â”‚
â”‚                                                          â”‚
â”‚  3. Simple Scaling                                      â”‚
â”‚     â”œâ”€ CPU > 70%: Add 2 instances                      â”‚
â”‚     â”œâ”€ CPU < 30%: Remove 1 instance                    â”‚
â”‚     â””â”€ Simple threshold-based                           â”‚
â”‚                                                          â”‚
â”‚  4. Scheduled Scaling                                   â”‚
â”‚     â”œâ”€ Scale up at 6 AM (rush hour)                    â”‚
â”‚     â”œâ”€ Scale down at 11 PM (low traffic)               â”‚
â”‚     â””â”€ Predictable traffic patterns                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Auto Scaling Flow Example

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Auto Scaling Flow (Uber API Servers)                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Time: 9:00 AM
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Current State:                                         â”‚
â”‚  â”œâ”€ Instances: 5                                        â”‚
â”‚  â”œâ”€ Average CPU: 45%                                    â”‚
â”‚  â””â”€ Requests/sec: 500                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â”‚ Rush Hour Starts
              â–¼
Time: 9:15 AM
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  CloudWatch Alarm Triggered:                            â”‚
â”‚  â”œâ”€ Metric: CPUUtilization                              â”‚
â”‚  â”œâ”€ Threshold: > 70%                                    â”‚
â”‚  â”œâ”€ Current: 75%                                       â”‚
â”‚  â””â”€ Action: Scale Out                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â”‚ Auto Scaling Policy Executes
              â–¼
Time: 9:16 AM
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Scaling Action:                                        â”‚
â”‚  â”œâ”€ Add 2 instances                                     â”‚
â”‚  â”œâ”€ Launch Template Used                                â”‚
â”‚  â”œâ”€ New Instances: 7 total                              â”‚
â”‚  â””â”€ Health Check: Waiting for healthy                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â”‚ Instances Become Healthy
              â–¼
Time: 9:18 AM
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  New State:                                             â”‚
â”‚  â”œâ”€ Instances: 7                                        â”‚
â”‚  â”œâ”€ Average CPU: 55%                                    â”‚
â”‚  â”œâ”€ Requests/sec: 700                                  â”‚
â”‚  â””â”€ All instances healthy                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â”‚ Traffic Decreases
              â–¼
Time: 11:00 PM
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  CloudWatch Alarm Triggered:                            â”‚
â”‚  â”œâ”€ Metric: CPUUtilization                              â”‚
â”‚  â”œâ”€ Threshold: < 30%                                    â”‚
â”‚  â”œâ”€ Current: 25%                                        â”‚
â”‚  â””â”€ Action: Scale In                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â”‚ Auto Scaling Policy Executes
              â–¼
Time: 11:01 PM
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Scaling Action:                                        â”‚
â”‚  â”œâ”€ Remove 1 instance                                  â”‚
â”‚  â”œâ”€ Terminate oldest instance                          â”‚
â”‚  â”œâ”€ New Instances: 6 total                              â”‚
â”‚  â””â”€ Drain connections gracefully                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Auto Scaling Configuration Example

```yaml
# Auto Scaling Group Configuration
AutoScalingGroup:
  Name: uber-api-servers
  MinSize: 3
  DesiredCapacity: 5
  MaxSize: 20
  
  LaunchTemplate:
    LaunchTemplateId: lt-api-server-v1
    Version: $Latest
  
  VPCZoneIdentifier:
    - subnet-1a
    - subnet-1b
    - subnet-1c
  
  HealthCheckType: ELB
  HealthCheckGracePeriod: 300
  
  ScalingPolicies:
    - PolicyName: scale-out-cpu
      PolicyType: TargetTrackingScaling
      TargetValue: 50.0
      PredefinedMetricSpecification:
        PredefinedMetricType: ASGAverageCPUUtilization
      ScaleInCooldown: 300
      ScaleOutCooldown: 60
    
    - PolicyName: scale-out-requests
      PolicyType: TargetTrackingScaling
      TargetValue: 1000.0
      PredefinedMetricSpecification:
        PredefinedMetricType: ALBRequestCountPerTarget
      ScaleInCooldown: 300
      ScaleOutCooldown: 60
```

### 3. Load Balancers (ALB, NLB, CLB)

Load balancers traffic ko multiple servers mein distribute karte hain.

#### Load Balancer Types Comparison

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Load Balancer Types                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Application Load Balancer (ALB)                        â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  Layer: Layer 7 (HTTP/HTTPS)                            â”‚
â”‚                                                          â”‚
â”‚  Features:                                               â”‚
â”‚  â”œâ”€ Path-based routing (/api/*, /ws/*)                 â”‚
â”‚  â”œâ”€ Host-based routing (api.uber.com, ws.uber.com)     â”‚
â”‚  â”œâ”€ SSL/TLS termination                                 â”‚
â”‚  â”œâ”€ Health checks                                       â”‚
â”‚  â”œâ”€ Sticky sessions                                     â”‚
â”‚  â””â”€ WebSocket support                                   â”‚
â”‚                                                          â”‚
â”‚  Use Cases:                                              â”‚
â”‚  â”œâ”€ API Servers (REST APIs)                             â”‚
â”‚  â”œâ”€ WebSocket Servers                                   â”‚
â”‚  â”œâ”€ Microservices                                       â”‚
â”‚  â””â”€ Container-based apps                                â”‚
â”‚                                                          â”‚
â”‚  For Uber:                                               â”‚
â”‚  â”œâ”€ API Load Balancer: api.uber.com                     â”‚
â”‚  â”œâ”€ WebSocket Load Balancer: ws.uber.com                â”‚
â”‚  â””â”€ Multiple target groups (API, WebSocket, Payment)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Network Load Balancer (NLB)                            â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  Layer: Layer 4 (TCP/UDP)                                â”‚
â”‚                                                          â”‚
â”‚  Features:                                               â”‚
â”‚  â”œâ”€ Ultra-low latency (< 100ms)                         â”‚
â”‚  â”œâ”€ High throughput (millions of requests/sec)          â”‚
â”‚  â”œâ”€ Static IP addresses                                 â”‚
â”‚  â”œâ”€ Source IP preservation                              â”‚
â”‚  â”œâ”€ TCP/UDP load balancing                              â”‚
â”‚  â””â”€ Health checks                                       â”‚
â”‚                                                          â”‚
â”‚  Use Cases:                                              â”‚
â”‚  â”œâ”€ Real-time applications                              â”‚
â”‚  â”œâ”€ Gaming servers                                      â”‚
â”‚  â”œâ”€ High-performance APIs                               â”‚
â”‚  â””â”€ IoT applications                                    â”‚
â”‚                                                          â”‚
â”‚  For Uber:                                               â”‚
â”‚  â”œâ”€ Real-time location updates                          â”‚
â”‚  â”œâ”€ High-frequency GPS updates                          â”‚
â”‚  â””â”€ Low-latency matching service                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Classic Load Balancer (CLB)                            â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  Layer: Layer 4 & Layer 7 (Legacy)                      â”‚
â”‚                                                          â”‚
â”‚  Features:                                               â”‚
â”‚  â”œâ”€ Basic HTTP/HTTPS load balancing                     â”‚
â”‚  â”œâ”€ SSL/TLS termination                                 â”‚
â”‚  â”œâ”€ Health checks                                       â”‚
â”‚  â””â”€ Sticky sessions                                     â”‚
â”‚                                                          â”‚
â”‚  Use Cases:                                              â”‚
â”‚  â”œâ”€ Legacy applications                                 â”‚
â”‚  â”œâ”€ EC2-Classic (old VPC)                               â”‚
â”‚  â””â”€ Simple load balancing needs                         â”‚
â”‚                                                          â”‚
â”‚  Note: AWS recommends ALB or NLB instead                â”‚
â”‚                                                          â”‚
â”‚  For Uber:                                               â”‚
â”‚  â””â”€ Not recommended (use ALB/NLB)                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### ALB Configuration for Uber

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Application Load Balancer Setup                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Load Balancer: uber-api-alb                            â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  Type: Application Load Balancer                        â”‚
â”‚  Scheme: Internet-facing                                â”‚
â”‚  IP Address Type: IPv4                                  â”‚
â”‚  Subnets: [subnet-1a, subnet-1b, subnet-1c]            â”‚
â”‚  Security Groups: [sg-alb-public]                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â”œâ”€ Listener 1: HTTPS (443)
              â”‚  â””â”€ SSL Certificate: *.uber.com
              â”‚     â””â”€ Rules:
              â”‚        â”œâ”€ Path: /api/* â†’ API Target Group
              â”‚        â”œâ”€ Path: /ws/* â†’ WebSocket Target Group
              â”‚        â””â”€ Default â†’ API Target Group
              â”‚
              â””â”€ Listener 2: HTTP (80)
                 â””â”€ Redirect to HTTPS (443)

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Target Group 1: api-servers                            â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  Protocol: HTTP                                         â”‚
â”‚  Port: 3000                                             â”‚
â”‚  Health Check:                                          â”‚
â”‚    â”œâ”€ Path: /health                                     â”‚
â”‚    â”œâ”€ Protocol: HTTP                                    â”‚
â”‚    â”œâ”€ Interval: 30 seconds                              â”‚
â”‚    â”œâ”€ Timeout: 5 seconds                                â”‚
â”‚    â”œâ”€ Healthy Threshold: 2                              â”‚
â”‚    â””â”€ Unhealthy Threshold: 3                            â”‚
â”‚                                                          â”‚
â”‚  Targets:                                               â”‚
â”‚    â”œâ”€ i-12345 (10.0.1.10:3000)                         â”‚
â”‚    â”œâ”€ i-12346 (10.0.1.11:3000)                         â”‚
â”‚    â””â”€ i-12347 (10.0.1.12:3000)                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Target Group 2: websocket-servers                      â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  Protocol: HTTP                                         â”‚
â”‚  Port: 3001                                             â”‚
â”‚  Health Check:                                          â”‚
â”‚    â”œâ”€ Path: /ws/health                                  â”‚
â”‚    â”œâ”€ Protocol: HTTP                                    â”‚
â”‚    â””â”€ Same as above                                      â”‚
â”‚                                                          â”‚
â”‚  Targets:                                               â”‚
â”‚    â”œâ”€ i-12348 (10.0.1.20:3001)                         â”‚
â”‚    â”œâ”€ i-12349 (10.0.1.21:3001)                         â”‚
â”‚    â””â”€ i-12350 (10.0.1.22:3001)                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Load Balancer Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Client    â”‚
â”‚  (Rider)    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ HTTPS Request
       â”‚ GET https://api.uber.com/api/rides/request
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      Application Load Balancer      â”‚
â”‚      (ALB)                          â”‚
â”‚                                     â”‚
â”‚  1. SSL Termination                 â”‚
â”‚     â”œâ”€ Decrypt HTTPS                â”‚
â”‚     â””â”€ Forward HTTP internally      â”‚
â”‚                                     â”‚
â”‚  2. Route Matching                   â”‚
â”‚     â”œâ”€ Path: /api/*                 â”‚
â”‚     â””â”€ Target Group: api-servers    â”‚
â”‚                                     â”‚
â”‚  3. Health Check                     â”‚
â”‚     â”œâ”€ Check target health          â”‚
â”‚     â””â”€ Route to healthy target      â”‚
â”‚                                     â”‚
â”‚  4. Load Balancing Algorithm        â”‚
â”‚     â”œâ”€ Round Robin (default)        â”‚
â”‚     â”œâ”€ Least Connections            â”‚
â”‚     â””â”€ IP Hash (sticky sessions)   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                  â”‚
       â”‚ Route            â”‚ Route
       â–¼                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ API Server  â”‚    â”‚ API Server  â”‚
â”‚ Instance 1  â”‚    â”‚ Instance 2  â”‚
â”‚             â”‚    â”‚             â”‚
â”‚ Healthy     â”‚    â”‚ Healthy     â”‚
â”‚ CPU: 45%    â”‚    â”‚ CPU: 50%    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4. Security Groups

Security Groups virtual firewalls hain jo EC2 instances aur load balancers ko protect karte hain.

#### Security Group Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Security Groups for Uber System                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Security Group: sg-alb-public                          â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  Description: Load Balancer Security Group              â”‚
â”‚                                                          â”‚
â”‚  Inbound Rules:                                          â”‚
â”‚  â”œâ”€ Type: HTTPS, Port: 443                              â”‚
â”‚  â”‚  Source: 0.0.0.0/0 (Internet)                        â”‚
â”‚  â”‚  Description: Allow HTTPS from internet              â”‚
â”‚  â”‚                                                     â”‚
â”‚  â”œâ”€ Type: HTTP, Port: 80                               â”‚
â”‚  â”‚  Source: 0.0.0.0/0 (Internet)                       â”‚
â”‚  â”‚  Description: Allow HTTP from internet               â”‚
â”‚  â”‚                                                     â”‚
â”‚  â””â”€ Type: Custom TCP, Port: 8080                       â”‚
â”‚     Source: sg-monitoring                               â”‚
â”‚     Description: Allow monitoring                       â”‚
â”‚                                                          â”‚
â”‚  Outbound Rules:                                         â”‚
â”‚  â””â”€ Type: All Traffic                                   â”‚
â”‚     Destination: 0.0.0.0/0                              â”‚
â”‚     Description: Allow all outbound                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Security Group: sg-api-servers                         â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  Description: API Server Instances                      â”‚
â”‚                                                          â”‚
â”‚  Inbound Rules:                                          â”‚
â”‚  â”œâ”€ Type: HTTP, Port: 3000                             â”‚
â”‚  â”‚  Source: sg-alb-public                              â”‚
â”‚  â”‚  Description: Allow from ALB only                    â”‚
â”‚  â”‚                                                     â”‚
â”‚  â”œâ”€ Type: Custom TCP, Port: 22                         â”‚
â”‚  â”‚  Source: sg-bastion (10.0.0.0/16)                   â”‚
â”‚  â”‚  Description: SSH from bastion only                  â”‚
â”‚  â”‚                                                     â”‚
â”‚  â””â”€ Type: Custom TCP, Port: 8080                       â”‚
â”‚     Source: sg-monitoring                               â”‚
â”‚     Description: Allow monitoring                       â”‚
â”‚                                                          â”‚
â”‚  Outbound Rules:                                         â”‚
â”‚  â”œâ”€ Type: HTTPS, Port: 443                             â”‚
â”‚  â”‚  Destination: 0.0.0.0/0                             â”‚
â”‚  â”‚  Description: Allow HTTPS (API calls)               â”‚
â”‚  â”‚                                                     â”‚
â”‚  â”œâ”€ Type: Custom TCP, Port: 6379                       â”‚
â”‚  â”‚  Destination: sg-redis                               â”‚
â”‚  â”‚  Description: Allow Redis access                    â”‚
â”‚  â”‚                                                     â”‚
â”‚  â””â”€ Type: Custom TCP, Port: 5432                       â”‚
â”‚     Destination: sg-database                            â”‚
â”‚     Description: Allow PostgreSQL access                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Security Group: sg-websocket-servers                   â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  Description: WebSocket Server Instances                â”‚
â”‚                                                          â”‚
â”‚  Inbound Rules:                                          â”‚
â”‚  â”œâ”€ Type: HTTP, Port: 3001                             â”‚
â”‚  â”‚  Source: sg-alb-public                              â”‚
â”‚  â”‚  Description: Allow from ALB                         â”‚
â”‚  â”‚                                                     â”‚
â”‚  â””â”€ Type: Custom TCP, Port: 22                         â”‚
â”‚     Source: sg-bastion                                  â”‚
â”‚     Description: SSH from bastion                       â”‚
â”‚                                                          â”‚
â”‚  Outbound Rules:                                         â”‚
â”‚  â”œâ”€ Type: Custom TCP, Port: 6379                       â”‚
â”‚  â”‚  Destination: sg-redis                               â”‚
â”‚  â”‚  Description: Allow Redis Pub/Sub                   â”‚
â”‚  â”‚                                                     â”‚
â”‚  â””â”€ Type: HTTPS, Port: 443                             â”‚
â”‚     Destination: 0.0.0.0/0                             â”‚
â”‚     Description: Allow external APIs                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Security Group: sg-redis                               â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  Description: Redis Cache Instances                     â”‚
â”‚                                                          â”‚
â”‚  Inbound Rules:                                          â”‚
â”‚  â”œâ”€ Type: Custom TCP, Port: 6379                       â”‚
â”‚  â”‚  Source: sg-api-servers                             â”‚
â”‚  â”‚  Description: Allow from API servers                 â”‚
â”‚  â”‚                                                     â”‚
â”‚  â”œâ”€ Type: Custom TCP, Port: 6379                       â”‚
â”‚  â”‚  Source: sg-websocket-servers                       â”‚
â”‚  â”‚  Description: Allow from WebSocket servers           â”‚
â”‚  â”‚                                                     â”‚
â”‚  â””â”€ Type: Custom TCP, Port: 6379                       â”‚
â”‚     Source: sg-matching-service                         â”‚
â”‚     Description: Allow from matching service            â”‚
â”‚                                                          â”‚
â”‚  Outbound Rules:                                         â”‚
â”‚  â””â”€ None (Redis doesn't need outbound)                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Security Group: sg-database                            â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  Description: PostgreSQL Database                       â”‚
â”‚                                                          â”‚
â”‚  Inbound Rules:                                          â”‚
â”‚  â”œâ”€ Type: Custom TCP, Port: 5432                       â”‚
â”‚  â”‚  Source: sg-api-servers                             â”‚
â”‚  â”‚  Description: Allow from API servers                 â”‚
â”‚  â”‚                                                     â”‚
â”‚  â”œâ”€ Type: Custom TCP, Port: 5432                       â”‚
â”‚  â”‚  Source: sg-payment-service                         â”‚
â”‚  â”‚  Description: Allow from payment service            â”‚
â”‚  â”‚                                                     â”‚
â”‚  â””â”€ Type: Custom TCP, Port: 5432                       â”‚
â”‚     Source: sg-backup-service                           â”‚
â”‚     Description: Allow from backup service              â”‚
â”‚                                                          â”‚
â”‚  Outbound Rules:                                         â”‚
â”‚  â””â”€ None (Database doesn't need outbound)               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Security Group Flow Example

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Request Flow with Security Groups                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Internet  â”‚
â”‚   Client    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ HTTPS Request (Port 443)
       â”‚ Source IP: 203.0.113.45
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Security Group: sg-alb-public       â”‚
â”‚                                     â”‚
â”‚  Inbound Rule Check:                â”‚
â”‚  â”œâ”€ Port: 443 âœ“                     â”‚
â”‚  â”œâ”€ Protocol: HTTPS âœ“               â”‚
â”‚  â””â”€ Source: 0.0.0.0/0 âœ“             â”‚
â”‚                                     â”‚
â”‚  âœ… ALLOWED                          â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ Forward to API Server
       â”‚ Source: ALB Private IP
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Security Group: sg-api-servers     â”‚
â”‚                                     â”‚
â”‚  Inbound Rule Check:                â”‚
â”‚  â”œâ”€ Port: 3000 âœ“                   â”‚
â”‚  â”œâ”€ Protocol: HTTP âœ“                â”‚
â”‚  â””â”€ Source: sg-alb-public âœ“        â”‚
â”‚                                     â”‚
â”‚  âœ… ALLOWED                          â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ API Server processes request
       â”‚ Needs to access Redis
       â”‚
       â”‚ Outbound to Redis (Port 6379)
       â”‚ Destination: sg-redis
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Security Group: sg-redis           â”‚
â”‚                                     â”‚
â”‚  Inbound Rule Check:                â”‚
â”‚  â”œâ”€ Port: 6379 âœ“                   â”‚
â”‚  â”œâ”€ Protocol: TCP âœ“                 â”‚
â”‚  â””â”€ Source: sg-api-servers âœ“       â”‚
â”‚                                     â”‚
â”‚  âœ… ALLOWED                          â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ Redis responds
       â”‚
       â”‚ Response flows back through
       â”‚ same security groups
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Client    â”‚
â”‚  Receives   â”‚
â”‚  Response   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Security Group Best Practices

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Security Group Best Practices                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1. âœ… Principle of Least Privilege
   â”œâ”€ Only allow necessary ports
   â”œâ”€ Only allow necessary source IPs
   â””â”€ Deny by default, allow explicitly

2. âœ… Use Security Group References
   â”œâ”€ Instead of IP addresses, use sg-xxx
   â”œâ”€ More maintainable
   â””â”€ Automatically updates when instances change

3. âœ… Separate Security Groups by Function
   â”œâ”€ sg-api-servers
   â”œâ”€ sg-database
   â”œâ”€ sg-redis
   â””â”€ sg-load-balancer

4. âœ… Don't Allow 0.0.0.0/0 for Database
   â”œâ”€ Only allow from application servers
   â””â”€ Use bastion host for SSH access

5. âœ… Regular Security Audits
   â”œâ”€ Review security group rules monthly
   â”œâ”€ Remove unused rules
   â””â”€ Use AWS Config for compliance

6. âœ… Use Network ACLs for Additional Layer
   â”œâ”€ Security Groups: Instance level
   â””â”€ Network ACLs: Subnet level

---

## ğŸ“ Key Takeaways

1. **Driver-Rider Matching**: 
   - Redis GeoIndex for fast location-based queries
   - Scoring algorithm considers distance, rating, acceptance rate
   - Push notifications to multiple drivers simultaneously

2. **Real-Time Tracking**:
   - WebSocket for bidirectional communication
   - Redis Pub/Sub for event distribution
   - Location updates every 5 seconds
   - ETA recalculation on each update

3. **Payment System**:
   - Integration with payment gateways (Stripe/PayPal)
   - Automatic fare calculation with surge pricing
   - Driver payout processing
   - Receipt generation

4. **Scalability**:
   - Horizontal scaling with load balancers
   - Redis for fast location queries
   - Database sharding by region
   - CDN for static content

5. **Reliability**:
   - Retry mechanisms for payments
   - Graceful degradation
   - Circuit breakers for external APIs
   - Monitoring and alerting

---

*Complete flow diagrams for Uber system design - ready for implementation!*
